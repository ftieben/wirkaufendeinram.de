# Apache Virtual Host Configuration for RAM Buying Site
# Place this in /etc/apache2/sites-available/rambuying.conf

<VirtualHost *:80>
    # Basic Configuration
    ServerName rambuying.local
    ServerAlias www.rambuying.local
    DocumentRoot /var/www/rambuying
    
    # Directory Configuration
    <Directory /var/www/rambuying>
        Options Indexes FollowSymLinks
        AllowOverride All
        Require all granted
        
        # Enable clean URLs (remove .html extension)
        RewriteEngine On
        
        # Handle directory index files
        DirectoryIndex index.html
        
        # Remove .html extension from URLs
        RewriteCond %{REQUEST_FILENAME} !-d
        RewriteCond %{REQUEST_FILENAME} !-f
        RewriteRule ^([^\.]+)$ $1.html [NC,L]
        
        # Redirect .html URLs to clean URLs
        RewriteCond %{THE_REQUEST} /([^.]+)\.html [NC]
        RewriteRule ^ /%1? [NC,L,R=301]
    </Directory>
    
    # Security Headers
    Header always set X-Content-Type-Options nosniff
    Header always set X-Frame-Options DENY
    Header always set X-XSS-Protection "1; mode=block"
    Header always set Referrer-Policy "strict-origin-when-cross-origin"
    Header always set Permissions-Policy "geolocation=(), microphone=(), camera=()"
    
    # Cache Control for Static Assets
    <LocationMatch "\.(css|js|png|jpg|jpeg|gif|ico|svg|woff|woff2|ttf|eot)$">
        ExpiresActive On
        ExpiresDefault "access plus 1 year"
        Header append Cache-Control "public, immutable"
    </LocationMatch>
    
    # Cache Control for HTML files
    <LocationMatch "\.html$">
        ExpiresActive On
        ExpiresDefault "access plus 1 hour"
        Header set Cache-Control "public, max-age=3600"
    </LocationMatch>
    
    # Compression
    <IfModule mod_deflate.c>
        AddOutputFilterByType DEFLATE text/plain
        AddOutputFilterByType DEFLATE text/html
        AddOutputFilterByType DEFLATE text/xml
        AddOutputFilterByType DEFLATE text/css
        AddOutputFilterByType DEFLATE application/xml
        AddOutputFilterByType DEFLATE application/xhtml+xml
        AddOutputFilterByType DEFLATE application/rss+xml
        AddOutputFilterByType DEFLATE application/javascript
        AddOutputFilterByType DEFLATE application/x-javascript
        AddOutputFilterByType DEFLATE application/json
    </IfModule>
    
    # Error and Access Logs
    ErrorLog ${APACHE_LOG_DIR}/rambuying_error.log
    CustomLog ${APACHE_LOG_DIR}/rambuying_access.log combined
    
    # Optional: Redirect HTTP to HTTPS (uncomment when you have SSL)
    # RewriteEngine On
    # RewriteCond %{HTTPS} off
    # RewriteRule ^(.*)$ https://%{HTTP_HOST}%{REQUEST_URI} [L,R=301]
</VirtualHost>

# SSL Virtual Host (uncomment and configure when you have SSL certificates)
# <VirtualHost *:443>
#     ServerName rambuying.local
#     ServerAlias www.rambuying.local
#     DocumentRoot /var/www/rambuying
#     
#     SSLEngine on
#     SSLCertificateFile /path/to/your/certificate.crt
#     SSLCertificateKeyFile /path/to/your/private.key
#     SSLCertificateChainFile /path/to/your/ca-bundle.crt
#     
#     # Include all the same directory and security configurations from above
#     <Directory /var/www/rambuying>
#         Options Indexes FollowSymLinks
#         AllowOverride All
#         Require all granted
#         
#         RewriteEngine On
#         DirectoryIndex index.html
#         
#         RewriteCond %{REQUEST_FILENAME} !-d
#         RewriteCond %{REQUEST_FILENAME} !-f
#         RewriteRule ^([^\.]+)$ $1.html [NC,L]
#         
#         RewriteCond %{THE_REQUEST} /([^.]+)\.html [NC]
#         RewriteRule ^ /%1? [NC,L,R=301]
#     </Directory>
#     
#     # Same headers and caching rules as HTTP version
# </VirtualHost>