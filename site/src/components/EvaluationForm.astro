---
/**
 * Evaluation Form Component
 * Collects RAM specifications and seller contact information with real-time validation
 */
---

<div class="evaluation-form-container">
  <div class="form-header">
    <h2>Get Your RAM Quote Instantly</h2>
    <p>Enter your RAM specifications below to receive an immediate price estimate</p>
    <div class="parody-hint">
      <span class="hint-icon">üöó‚û°Ô∏èüíæ</span>
      <span class="hint-text">Just like selling a car, but way more nerdy!</span>
    </div>
  </div>

  <form id="ram-evaluation-form" class="evaluation-form">
    <!-- RAM Specifications Section -->
    <fieldset class="form-section">
      <legend>RAM Specifications</legend>
      
      <div class="form-group">
        <label for="ram-type">RAM Type *</label>
        <select id="ram-type" name="type" required>
          <option value="">Select RAM Type</option>
          <option value="DDR3">DDR3</option>
          <option value="DDR4">DDR4</option>
          <option value="DDR5">DDR5</option>
        </select>
        <div class="error-message" id="type-error"></div>
      </div>

      <div class="form-group">
        <label for="capacity">Capacity (GB) *</label>
        <select id="capacity" name="capacity" required>
          <option value="">Select Capacity</option>
          <option value="1">1 GB</option>
          <option value="2">2 GB</option>
          <option value="4">4 GB</option>
          <option value="8">8 GB</option>
          <option value="16">16 GB</option>
          <option value="32">32 GB</option>
          <option value="64">64 GB</option>
          <option value="128">128 GB</option>
        </select>
        <div class="error-message" id="capacity-error"></div>
      </div>

      <div class="form-group">
        <label for="speed">Speed (MHz) *</label>
        <input 
          type="number" 
          id="speed" 
          name="speed" 
          placeholder="e.g., 3200" 
          min="800" 
          max="6400" 
          required
        />
        <div class="error-message" id="speed-error"></div>
        <div class="help-text">Common speeds: DDR3 (800-2133), DDR4 (1600-3200), DDR5 (3200-6400)</div>
      </div>

      <div class="form-group">
        <label for="brand">Brand *</label>
        <select id="brand" name="brand" required>
          <option value="">Select Brand</option>
          <option value="Corsair">Corsair</option>
          <option value="G.Skill">G.Skill</option>
          <option value="Kingston">Kingston</option>
          <option value="Crucial">Crucial</option>
          <option value="Samsung">Samsung</option>
          <option value="SK Hynix">SK Hynix</option>
          <option value="Micron">Micron</option>
          <option value="ADATA">ADATA</option>
          <option value="Team">Team</option>
          <option value="Patriot">Patriot</option>
          <option value="HyperX">HyperX</option>
          <option value="Mushkin">Mushkin</option>
          <option value="GeIL">GeIL</option>
        </select>
        <div class="error-message" id="brand-error"></div>
      </div>

      <div class="form-group">
        <label for="condition">Condition *</label>
        <select id="condition" name="condition" required>
          <option value="">Select Condition</option>
          <option value="new">New (unopened, with warranty)</option>
          <option value="excellent">Excellent (like new, minimal use)</option>
          <option value="good">Good (normal wear, fully functional)</option>
          <option value="fair">Fair (visible wear, but working)</option>
        </select>
        <div class="error-message" id="condition-error"></div>
      </div>

      <div class="form-group">
        <label for="quantity">Quantity *</label>
        <input 
          type="number" 
          id="quantity" 
          name="quantity" 
          placeholder="Number of modules" 
          min="1" 
          max="100" 
          required
        />
        <div class="error-message" id="quantity-error"></div>
      </div>
    </fieldset>

    <!-- Contact Information Section -->
    <fieldset class="form-section">
      <legend>Contact Information</legend>
      
      <div class="form-group">
        <label for="name">Full Name *</label>
        <input 
          type="text" 
          id="name" 
          name="name" 
          placeholder="Your full name" 
          required
        />
        <div class="error-message" id="name-error"></div>
      </div>

      <div class="form-group">
        <label for="email">Email Address *</label>
        <input 
          type="email" 
          id="email" 
          name="email" 
          placeholder="your.email@example.com" 
          required
        />
        <div class="error-message" id="email-error"></div>
      </div>

      <div class="form-group">
        <label for="phone">Phone Number *</label>
        <input 
          type="tel" 
          id="phone" 
          name="phone" 
          placeholder="(555) 123-4567" 
          required
        />
        <div class="error-message" id="phone-error"></div>
      </div>

      <div class="form-group">
        <label for="preferred-contact">Preferred Contact Method *</label>
        <select id="preferred-contact" name="preferredContact" required>
          <option value="">Select preference</option>
          <option value="email">Email</option>
          <option value="phone">Phone</option>
          <option value="either">Either email or phone</option>
        </select>
        <div class="error-message" id="preferredContact-error"></div>
      </div>

      <div class="form-group">
        <label for="location">Location (City, State) *</label>
        <input 
          type="text" 
          id="location" 
          name="location" 
          placeholder="e.g., San Francisco, CA" 
          required
        />
        <div class="error-message" id="location-error"></div>
        <div class="help-text">Used for shipping cost estimates</div>
      </div>
    </fieldset>

    <!-- Form Actions -->
    <div class="form-actions">
      <button type="button" id="clear-form" class="btn-secondary">Clear Form</button>
      <button type="submit" id="submit-form" class="btn-primary">Get My Quote</button>
    </div>

    <!-- Loading State -->
    <div id="loading-state" class="loading-state" style="display: none;">
      <div class="spinner"></div>
      <p>Calculating your quote...</p>
    </div>
  </form>

  <!-- Quote Results Section -->
  <div id="quote-results" class="quote-results" style="display: none;">
    <div class="quote-header">
      <h3>Your RAM Quote</h3>
    </div>
    <div class="quote-content">
      <div class="estimated-value">
        <span class="label">Estimated Value:</span>
        <span class="value" id="quote-value">$0.00</span>
      </div>
      <div class="price-range">
        <span class="label">Price Range:</span>
        <span class="range" id="quote-range">$0.00 - $0.00</span>
      </div>
      <div class="timeline">
        <span class="label">Response Time:</span>
        <span class="time" id="quote-timeline">-</span>
      </div>
      <div class="factors">
        <h4>Pricing Factors:</h4>
        <ul id="quote-factors"></ul>
      </div>
      <div class="next-steps">
        <h4>Next Steps:</h4>
        <ol id="quote-next-steps"></ol>
      </div>
    </div>
    <div class="quote-actions">
      <button type="button" id="new-quote" class="btn-secondary">Get Another Quote</button>
      <button type="button" id="accept-quote" class="btn-primary">Accept This Quote</button>
    </div>
  </div>
</div>

<style>
  .evaluation-form-container {
    max-width: 800px;
    margin: 0 auto;
    padding: 2rem;
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
  }

  .form-header {
    text-align: center;
    margin-bottom: 2rem;
  }

  .form-header h2 {
    color: #1a365d;
    font-size: 2rem;
    margin-bottom: 0.5rem;
  }

  .form-header p {
    color: #4a5568;
    font-size: 1.1rem;
    margin-bottom: 1rem;
  }

  .parody-hint {
    background: linear-gradient(135deg, #ffd700 0%, #ffed4e 100%);
    border: 1px solid #f6ad55;
    border-radius: 20px;
    padding: 0.75rem 1.5rem;
    display: inline-flex;
    align-items: center;
    gap: 0.5rem;
    margin-top: 0.5rem;
  }

  .hint-icon {
    font-size: 1rem;
  }

  .hint-text {
    color: #744210;
    font-weight: 500;
    font-size: 0.875rem;
  }

  .evaluation-form {
    background: #ffffff;
    border-radius: 8px;
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    padding: 2rem;
  }

  .form-section {
    border: 1px solid #e2e8f0;
    border-radius: 6px;
    padding: 1.5rem;
    margin-bottom: 2rem;
  }

  .form-section legend {
    font-weight: 600;
    color: #2d3748;
    padding: 0 0.5rem;
    font-size: 1.1rem;
  }

  .form-group {
    margin-bottom: 1.5rem;
  }

  .form-group label {
    display: block;
    font-weight: 500;
    color: #2d3748;
    margin-bottom: 0.5rem;
  }

  .form-group input,
  .form-group select {
    width: 100%;
    padding: 0.75rem;
    border: 2px solid #e2e8f0;
    border-radius: 4px;
    font-size: 1rem;
    transition: border-color 0.2s ease;
  }

  .form-group input:focus,
  .form-group select:focus {
    outline: none;
    border-color: #3182ce;
    box-shadow: 0 0 0 3px rgba(49, 130, 206, 0.1);
  }

  .form-group input.error,
  .form-group select.error {
    border-color: #e53e3e;
  }

  .error-message {
    color: #e53e3e;
    font-size: 0.875rem;
    margin-top: 0.25rem;
    min-height: 1.25rem;
  }

  .help-text {
    color: #718096;
    font-size: 0.875rem;
    margin-top: 0.25rem;
  }

  .form-actions {
    display: flex;
    gap: 1rem;
    justify-content: flex-end;
    margin-top: 2rem;
  }

  .btn-primary,
  .btn-secondary {
    padding: 0.75rem 1.5rem;
    border-radius: 4px;
    font-weight: 500;
    cursor: pointer;
    transition: all 0.2s ease;
    border: none;
    font-size: 1rem;
  }

  .btn-primary {
    background-color: #3182ce;
    color: white;
  }

  .btn-primary:hover {
    background-color: #2c5aa0;
  }

  .btn-primary:disabled {
    background-color: #a0aec0;
    cursor: not-allowed;
  }

  .btn-secondary {
    background-color: #edf2f7;
    color: #4a5568;
    border: 1px solid #e2e8f0;
  }

  .btn-secondary:hover {
    background-color: #e2e8f0;
  }

  .loading-state {
    text-align: center;
    padding: 2rem;
  }

  .spinner {
    width: 40px;
    height: 40px;
    border: 4px solid #e2e8f0;
    border-top: 4px solid #3182ce;
    border-radius: 50%;
    animation: spin 1s linear infinite;
    margin: 0 auto 1rem;
  }

  @keyframes spin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
  }

  .quote-results {
    background: #f7fafc;
    border-radius: 8px;
    padding: 2rem;
    margin-top: 2rem;
    border: 1px solid #e2e8f0;
  }

  .quote-header h3 {
    color: #1a365d;
    margin-bottom: 1.5rem;
    text-align: center;
  }

  .estimated-value {
    text-align: center;
    margin-bottom: 1rem;
  }

  .estimated-value .value {
    font-size: 2.5rem;
    font-weight: bold;
    color: #38a169;
    display: block;
    transition: transform 0.3s ease;
  }

  .price-range,
  .timeline {
    display: flex;
    justify-content: space-between;
    margin-bottom: 1rem;
    padding: 0.5rem 0;
    border-bottom: 1px solid #e2e8f0;
  }

  .factors,
  .next-steps {
    margin: 1.5rem 0;
  }

  .factors h4,
  .next-steps h4 {
    color: #2d3748;
    margin-bottom: 0.5rem;
  }

  .factors ul,
  .next-steps ol {
    margin: 0;
    padding-left: 1.5rem;
  }

  .factors li,
  .next-steps li {
    margin-bottom: 0.25rem;
    color: #4a5568;
  }

  .quote-actions {
    display: flex;
    gap: 1rem;
    justify-content: center;
    margin-top: 2rem;
  }

  @media (max-width: 768px) {
    .evaluation-form-container {
      padding: 1rem;
    }

    .form-actions,
    .quote-actions {
      flex-direction: column;
    }

    .btn-primary,
    .btn-secondary {
      width: 100%;
    }
  }
</style>

<script>
  import { validateRAMSpecification, validateSellerContact } from '../lib/validation.js';
  import { generateQuote } from '../lib/pricing.js';
  import type { RAMSpecification, SellerContact, QuoteResponse, ValidationError } from '../lib/types.js';

  // Form elements with proper null safety
  const form = document.getElementById('ram-evaluation-form') as HTMLFormElement | null;
  const loadingState = document.getElementById('loading-state') as HTMLElement | null;
  const quoteResults = document.getElementById('quote-results') as HTMLElement | null;
  const clearButton = document.getElementById('clear-form') as HTMLButtonElement | null;
  const newQuoteButton = document.getElementById('new-quote') as HTMLButtonElement | null;
  const acceptQuoteButton = document.getElementById('accept-quote') as HTMLButtonElement | null;

  // Form state with proper typing
  let currentQuote: QuoteResponse | null = null;

  // Real-time validation setup
  function setupRealTimeValidation(): void {
    if (!form) return;
    
    const fields = form.querySelectorAll('input, select') as NodeListOf<HTMLInputElement | HTMLSelectElement>;
    
    fields.forEach(field => {
      field.addEventListener('blur', () => validateField(field));
      field.addEventListener('input', () => clearFieldError(field));
    });
  }

  // Validate individual field
  function validateField(field: HTMLInputElement | HTMLSelectElement): void {
    const fieldName = field.name;
    
    // Clear previous error
    clearFieldError(field);
    
    // Get current form data for context-aware validation
    const formData = getFormData();
    if (!formData) return;
    
    // Validate based on field type
    if (['type', 'capacity', 'speed', 'brand', 'condition', 'quantity'].includes(fieldName)) {
      const ramValidation = validateRAMSpecification(formData.ramSpec);
      const fieldError = ramValidation.errors.find((error: ValidationError) => error.field === fieldName);
      if (fieldError) {
        showFieldError(field, fieldError.message);
      }
    } else if (['name', 'email', 'phone', 'preferredContact', 'location'].includes(fieldName)) {
      const contactValidation = validateSellerContact(formData.contact);
      const fieldError = contactValidation.errors.find((error: ValidationError) => error.field === fieldName);
      if (fieldError) {
        showFieldError(field, fieldError.message);
      }
    }
  }

  // Show field error
  function showFieldError(field: HTMLInputElement | HTMLSelectElement, message: string): void {
    field.classList.add('error');
    const errorElement = document.getElementById(`${field.name}-error`);
    if (errorElement) {
      errorElement.textContent = message;
    }
  }

  // Clear field error
  function clearFieldError(field: HTMLInputElement | HTMLSelectElement): void {
    field.classList.remove('error');
    const errorElement = document.getElementById(`${field.name}-error`);
    if (errorElement) {
      errorElement.textContent = '';
    }
  }

  // Clear all errors
  function clearAllErrors(): void {
    if (!form) return;
    
    const fields = form.querySelectorAll('input, select') as NodeListOf<HTMLInputElement | HTMLSelectElement>;
    fields.forEach(field => clearFieldError(field));
  }

  // Get form data with proper type handling
  function getFormData(): { ramSpec: Partial<RAMSpecification>; contact: Partial<SellerContact> } | null {
    if (!form) return null;
    
    const formData = new FormData(form);
    
    // Helper function to safely get string values from FormData
    const getString = (key: string): string => {
      const value = formData.get(key);
      return typeof value === 'string' ? value : '';
    };
    
    // Helper function to safely parse integers
    const getInt = (key: string): number => {
      const value = getString(key);
      const parsed = parseInt(value, 10);
      return isNaN(parsed) ? 0 : parsed;
    };
    
    const ramSpec: Partial<RAMSpecification> = {
      type: getString('type') as RAMSpecification['type'] || undefined,
      capacity: getInt('capacity') || undefined,
      speed: getInt('speed') || undefined,
      brand: getString('brand') || undefined,
      condition: getString('condition') as RAMSpecification['condition'] || undefined,
      quantity: getInt('quantity') || undefined
    };

    const contact: Partial<SellerContact> = {
      name: getString('name') || undefined,
      email: getString('email') || undefined,
      phone: getString('phone') || undefined,
      preferredContact: getString('preferredContact') as SellerContact['preferredContact'] || undefined,
      location: getString('location') || undefined
    };

    return { ramSpec, contact };
  }

  // Validate entire form
  function validateForm(): boolean {
    const formData = getFormData();
    if (!formData) return false;
    
    const { ramSpec, contact } = formData;
    
    const ramValidation = validateRAMSpecification(ramSpec);
    const contactValidation = validateSellerContact(contact);
    
    // Show RAM specification errors
    ramValidation.errors.forEach((error: ValidationError) => {
      if (!form) return;
      const field = form.querySelector(`[name="${error.field}"]`) as HTMLInputElement | HTMLSelectElement | null;
      if (field) {
        showFieldError(field, error.message);
      }
    });
    
    // Show contact errors
    contactValidation.errors.forEach((error: ValidationError) => {
      if (!form) return;
      const field = form.querySelector(`[name="${error.field}"]`) as HTMLInputElement | HTMLSelectElement | null;
      if (field) {
        showFieldError(field, error.message);
      }
    });
    
    return ramValidation.isValid && contactValidation.isValid;
  }

  // Display quote results
  function displayQuote(quote: QuoteResponse): void {
    const valueElement = document.getElementById('quote-value');
    const rangeElement = document.getElementById('quote-range');
    const timelineElement = document.getElementById('quote-timeline');
    const factorsElement = document.getElementById('quote-factors');
    const stepsElement = document.getElementById('quote-next-steps');

    if (valueElement) valueElement.textContent = `$${quote.estimatedValue.toFixed(2)}`;
    if (rangeElement) rangeElement.textContent = `$${quote.priceRange.min.toFixed(2)} - $${quote.priceRange.max.toFixed(2)}`;
    if (timelineElement) timelineElement.textContent = quote.timeline;

    // Display factors
    if (factorsElement) {
      factorsElement.innerHTML = '';
      quote.factors.forEach((factor: string) => {
        const li = document.createElement('li');
        li.textContent = factor;
        factorsElement.appendChild(li);
      });
    }

    // Display next steps
    if (stepsElement) {
      stepsElement.innerHTML = '';
      quote.nextSteps.forEach((step: string) => {
        const li = document.createElement('li');
        li.textContent = step;
        stepsElement.appendChild(li);
      });
    }

    // Show results
    if (quoteResults) {
      quoteResults.style.display = 'block';
      
      // Add a fade-in animation
      quoteResults.style.opacity = '0';
      quoteResults.style.transform = 'translateY(20px)';
      
      // Trigger animation
      setTimeout(() => {
        quoteResults.style.transition = 'opacity 0.5s ease, transform 0.5s ease';
        quoteResults.style.opacity = '1';
        quoteResults.style.transform = 'translateY(0)';
      }, 100);
      
      quoteResults.scrollIntoView({ behavior: 'smooth' });
    }

    // Show success feedback message
    showQuoteGenerationSuccess();
  }

  // Show success feedback for quote generation
  function showQuoteGenerationSuccess(): void {
    // Create a temporary success message
    const successMessage = document.createElement('div');
    successMessage.innerHTML = `
      <div style="
        position: fixed;
        top: 20px;
        right: 20px;
        background: #38a169;
        color: white;
        padding: 1rem 1.5rem;
        border-radius: 4px;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        z-index: 999;
        font-weight: 500;
      ">
        ‚úì Quote generated successfully!
      </div>
    `;
    
    document.body.appendChild(successMessage);
    
    // Remove the message after 3 seconds
    setTimeout(() => {
      if (successMessage.parentNode) {
        successMessage.parentNode.removeChild(successMessage);
      }
    }, 3000);
  }

  // Form submission handler
  async function handleFormSubmission(event: Event): Promise<void> {
    event.preventDefault();
    
    // Clear previous errors
    clearAllErrors();
    
    // Validate form
    if (!validateForm()) {
      return;
    }
    
    // Show loading state
    if (loadingState) loadingState.style.display = 'block';
    if (quoteResults) quoteResults.style.display = 'none';
    
    try {
      // Get form data
      const formData = getFormData();
      if (!formData) {
        throw new Error('Unable to get form data');
      }
      
      const { ramSpec } = formData;
      
      // Validate that we have a complete RAM specification
      if (!ramSpec.type || !ramSpec.capacity || !ramSpec.speed || !ramSpec.brand || !ramSpec.condition || !ramSpec.quantity) {
        throw new Error('Incomplete RAM specification');
      }
      
      // Simulate processing delay
      await new Promise(resolve => setTimeout(resolve, 1500));
      
      // Generate quote with properly typed specification
      const completeRamSpec: RAMSpecification = {
        type: ramSpec.type,
        capacity: ramSpec.capacity,
        speed: ramSpec.speed,
        brand: ramSpec.brand,
        condition: ramSpec.condition,
        quantity: ramSpec.quantity
      };
      
      const quote = generateQuote(completeRamSpec);
      currentQuote = quote;
      
      // Hide loading state
      if (loadingState) loadingState.style.display = 'none';
      
      // Display quote
      displayQuote(quote);
      
    } catch (error) {
      console.error('Error generating quote:', error);
      if (loadingState) loadingState.style.display = 'none';
      alert('Sorry, there was an error generating your quote. Please try again.');
    }
  }

  // Clear form handler
  function handleClearForm(): void {
    if (!form) return;
    
    form.reset();
    clearAllErrors();
    if (quoteResults) quoteResults.style.display = 'none';
    currentQuote = null;
  }

  // New quote handler
  function handleNewQuote(): void {
    if (quoteResults) quoteResults.style.display = 'none';
    currentQuote = null;
    if (form) form.scrollIntoView({ behavior: 'smooth' });
  }

  // Accept quote handler
  function handleAcceptQuote(): void {
    if (currentQuote) {
      // Get the user's contact preferences
      const formData = getFormData();
      if (formData && formData.contact.preferredContact) {
        const contactMethod = formData.contact.preferredContact;
        const contactInfo = formData.contact;
        
        // Create a personalized message based on contact preference
        let message = 'Thank you for accepting our quote! ';
        
        switch (contactMethod) {
          case 'email':
            message += `We will contact you via email at ${contactInfo.email} within the timeframe specified in your quote.`;
            break;
          case 'phone':
            message += `We will contact you via phone at ${contactInfo.phone} within the timeframe specified in your quote.`;
            break;
          case 'either':
            message += `We will contact you via email (${contactInfo.email}) or phone (${contactInfo.phone}) within the timeframe specified in your quote.`;
            break;
          default:
            message += 'We will contact you soon to finalize the purchase.';
        }
        
        // Show enhanced confirmation with contact preference details
        showQuoteAcceptanceConfirmation(message, currentQuote.timeline);
      } else {
        alert('Thank you! We will contact you soon to finalize the purchase.');
      }
      
      // In a real application, this would submit the quote acceptance to a backend service
      // For now, we'll simulate the submission
      simulateQuoteSubmission();
    }
  }

  // Show enhanced quote acceptance confirmation
  function showQuoteAcceptanceConfirmation(message: string, timeline: string): void {
    // Create a more prominent confirmation dialog
    const confirmationHtml = `
      <div style="
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.5);
        display: flex;
        justify-content: center;
        align-items: center;
        z-index: 1000;
      " id="quote-confirmation-overlay">
        <div style="
          background: white;
          padding: 2rem;
          border-radius: 8px;
          max-width: 500px;
          margin: 1rem;
          box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
        ">
          <h3 style="color: #38a169; margin-bottom: 1rem; text-align: center;">
            ‚úì Quote Accepted Successfully!
          </h3>
          <p style="margin-bottom: 1rem; line-height: 1.5;">
            ${message}
          </p>
          <div style="
            background: #f7fafc;
            padding: 1rem;
            border-radius: 4px;
            margin-bottom: 1rem;
            border-left: 4px solid #38a169;
          ">
            <strong>Expected Response Time:</strong> ${timeline}
          </div>
          <div style="text-align: center;">
            <button onclick="closeQuoteConfirmation()" style="
              background: #3182ce;
              color: white;
              border: none;
              padding: 0.75rem 1.5rem;
              border-radius: 4px;
              cursor: pointer;
              font-weight: 500;
            ">
              Close
            </button>
          </div>
        </div>
      </div>
    `;
    
    // Add the confirmation to the page
    document.body.insertAdjacentHTML('beforeend', confirmationHtml);
    
    // Add close function to global scope temporarily
    (window as any).closeQuoteConfirmation = () => {
      const overlay = document.getElementById('quote-confirmation-overlay');
      if (overlay) {
        overlay.remove();
      }
      delete (window as any).closeQuoteConfirmation;
    };
  }

  // Simulate quote submission (in a real app, this would be an API call)
  function simulateQuoteSubmission(): void {
    // Log the submission for debugging
    console.log('Quote submission simulated:', {
      quote: currentQuote,
      timestamp: new Date().toISOString(),
      contactInfo: getFormData()?.contact
    });
    
    // In a real application, you would:
    // 1. Send the quote acceptance to your backend API
    // 2. Store the submission in a database
    // 3. Trigger email notifications to your team
    // 4. Set up follow-up reminders based on the timeline
  }

  // Initialize form
  function initializeForm(): void {
    setupRealTimeValidation();
    
    // Event listeners with null safety
    if (form) form.addEventListener('submit', handleFormSubmission);
    if (clearButton) clearButton.addEventListener('click', handleClearForm);
    if (newQuoteButton) newQuoteButton.addEventListener('click', handleNewQuote);
    if (acceptQuoteButton) acceptQuoteButton.addEventListener('click', handleAcceptQuote);
  }

  // Initialize when DOM is loaded
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', initializeForm);
  } else {
    initializeForm();
  }
</script>